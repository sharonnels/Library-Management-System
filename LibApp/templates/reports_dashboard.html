{% extends "base.html" %}
{% block content %}
<div class="container my-5">
  <h2 class="text-center text-primary mb-4"> Library Reports Dashboard</h2>

  <div class="row g-4 mb-4 text-center">
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title fw-bold">Total Fines Collected</h5>
          <p class="display-6 text-success fw-bold">₹{{ total_fines }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title fw-bold">Top Accessed Books</h5>
          <p class="display-6 text-primary fw-bold">{{ top_books|length }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title fw-bold">Unused Books</h5>
          <p class="display-6 text-danger fw-bold">{{ unused_books|length }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white fw-bold">
       Top 10 Accessed Books
    </div>
    <div class="card-body p-0">
      {% if top_books %}
      <table class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Title</th>
            <th scope="col">Author</th>
            <th scope="col">Access Count</th>
          </tr>
        </thead>
        <tbody>
          {% for book in top_books %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ book.title }}</td>
            <td>{{ book.author }}</td>
            <td><span class="badge bg-primary">{{ book.access_count }}</span></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center my-3 text-muted">No books accessed yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Unused Books -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-danger text-white fw-bold">
       Unused Books (Access Count = 0)
    </div>
    <div class="card-body p-0">
      {% if unused_books %}
      <table class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">Book ID</th>
            <th scope="col">Title</th>
            <th scope="col">Author</th>
          </tr>
        </thead>
        <tbody>
          {% for book in unused_books %}
          <tr>
            <td>{{ book.id }}</td>
            <td>{{ book.title }}</td>
            <td>{{ book.author }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center my-3 text-muted">No unused books found.</p>
      {% endif %}
    </div>
  </div>

  <div class="card shadow-sm mb-5">
    <div class="card-header bg-success text-white fw-bold">
       Fine Details
    </div>
    <div class="card-body p-0">
      {% if fines %}
      <table class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">Issue ID</th>
            <th scope="col">Book</th>
            <th scope="col">Student</th>
            <th scope="col">Fine Paid (₹)</th>
          </tr>
        </thead>
        <tbody>
          {% for fine in fines %}
          <tr>
            <td>{{ fine.id }}</td>
            <td>{{ fine.book.title }}</td>
            <td>{{ fine.student.name }}</td>
            <td class="text-success fw-bold">{{ fine.fine_paid }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center my-3 text-muted">No fines recorded yet.</p>
      {% endif %}
    </div>
  </div>

  <div class="text-center">
    <a href="/dashboard" class="btn btn-secondary px-4">⬅ Back to Dashboard</a>
  </div>
</div>
{% endblock %}